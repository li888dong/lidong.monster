{"version":3,"sources":["webpack://index/webpack/bootstrap","webpack://index/C:/Users/xiedajian/AppData/Roaming/npm/node_modules/@vue/cli-service/node_modules/@soda/get-current-script/index.js","webpack://index/C:/Users/xiedajian/AppData/Roaming/npm/node_modules/@vue/cli-service/lib/commands/build/setPublicPath.js","webpack://index/./package/core/media.js","webpack://index/./package/core/context.js","webpack://index/./package/core/incontext.js","webpack://index/./package/core/outcontext.js","webpack://index/./package/config.js","webpack://index/./package/io/encoder.js","webpack://index/./package/net/ws.js","webpack://index/./package/io/blob.js","webpack://index/./package/core/as3context.js","webpack://index/./package/core/audio.js","webpack://index/./package/utils/pollfill.js","webpack://index/./package/core/pcm-player.js","webpack://index/./package/core/player.js","webpack://index/./package/index.js","webpack://index/C:/Users/xiedajian/AppData/Roaming/npm/node_modules/@vue/cli-service/lib/commands/build/entry-lib-no-default.js"],"names":[],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;AClFA;AACA;AACA;;AAEA;;AAEA;AACA,MAAM,IAA0C;AAChD,IAAI,iCAAO,EAAE,oCAAE,OAAO;AAAA;AAAA;AAAA,oGAAC;AACvB,GAAG,MAAM,EAIN;AACH,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D;;AAE1D;AACA;AACA,+DAA+D,qBAAqB;AACpF;AACA;;AAEA,qBAAqB,oBAAoB;AACzC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;;;;;;;;;;;;;;;;ACvED;;AAEA;AACA;AACA,MAAM,IAAuC;AAC7C,2BAA2B,mBAAO,CAAC,MAA0B;AAC7D;;AAEA;AACA;AACA,wDAAwD,wBAAwB;AAChF;AACA;;AAEA;AACA;AACA,IAAI,qBAAuB;AAC3B;AACA;;AAEA;AACe,sDAAI;;;ACrBnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB,SAAS;AACT;AACA;AACA,C;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,eAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,C;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACoC;;AAE7B,MAAM,mBAAS,SAAS,OAAO;AACtC;AACA;AACA,eAAe,OAAO;AACtB,eAAe,OAAO;AACtB;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iCAAiC,wCAAwC;AACzE;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,uDAAuD;AACvD,0DAA0D;AAC1D;AACA;AACA;AACA;AACA,2BAA2B,mBAAmB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACoC;;;AAG7B,MAAM,0BAAe,SAAS,OAAO;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,YAAY;AAC/B;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,mBAAmB,MAAM;AACzB;AACA;AACA;AACA,2BAA2B,4CAA4C;AACvE,+DAA+D;AAC/D,gCAAgC,uBAAuB;AACvD;AACA;AACA;AACA;AACA;AACA;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2BAA2B,kBAAkB;AAC7C;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,2BAA2B,kBAAkB;AAC7C;AACA;AACA;AACA;;AAEA;AACA;AACA,C;;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO;AACP;AACA;AACA;AACA,mDAAmD;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,C;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,C;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,+BAA+B,oBAAoB;AACnD;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,uBAAuB,sBAAsB;AAC7C;AACA;;AAEA;AACA;AACA,C;;ACtFA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,eAAe,iBAAiB;AAChC;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,gCAAgC;AACrD;AACA;AACA;AACA,mBAAmB,YAAY;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEe,wDAAS,E;;AC/HxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACgC;AACQ;AACO;AACL;AACF;AACT;AACO;AACI;AACV;AACa;AACR;;AAE9B,MAAM,aAAM;AACnB;AACA;AACA;AACA;AACA,QAAQ,QAAQ,0BAA0B,aAAa,oBAAoB,aAAa;AACxF;AACA,6BAA6B,0BAAe;AAC5C,wBAAwB,KAAK;AAC7B;AACA;;AAEA;AACA,mCAAmC,UAAU;AAC7C;AACA,uBAAuB,EAAE;AACzB,mBAAmB,UAAS;AAC5B;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA,0CAA0C,mBAAS;AACnD,iBAAiB;AACjB;AACA,iBAAiB;AACjB,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,OAAO;AACtC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,OAAO;AACvC,0BAA0B,QAAQ;AAClC;AACA;AACA;AACA,SAAS;AACT;AACA,gCAAgC,OAAO;AACvC,0BAA0B,QAAQ;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;;ACxJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACqC;AACE;;AAEvC;AACA,IAAI,aAAK,OAAO,KAAK;;AAErB;AACA,eAAe,aAAM;AACrB;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;AChCuB;AACF","file":"index.common.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"bc95\");\n","// addapted from the document.currentScript polyfill by Adam Miller\n// MIT license\n// source: https://github.com/amiller-gh/currentScript-polyfill\n\n// added support for Firefox https://bugzilla.mozilla.org/show_bug.cgi?id=1620505\n\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory();\n  } else {\n    root.getCurrentScript = factory();\n  }\n}(typeof self !== 'undefined' ? self : this, function () {\n  function getCurrentScript () {\n    if (document.currentScript) {\n      return document.currentScript\n    }\n  \n    // IE 8-10 support script readyState\n    // IE 11+ & Firefox support stack trace\n    try {\n      throw new Error();\n    }\n    catch (err) {\n      // Find the second match for the \"at\" string to get file src url from stack.\n      var ieStackRegExp = /.*at [^(]*\\((.*):(.+):(.+)\\)$/ig,\n        ffStackRegExp = /@([^@]*):(\\d+):(\\d+)\\s*$/ig,\n        stackDetails = ieStackRegExp.exec(err.stack) || ffStackRegExp.exec(err.stack),\n        scriptLocation = (stackDetails && stackDetails[1]) || false,\n        line = (stackDetails && stackDetails[2]) || false,\n        currentLocation = document.location.href.replace(document.location.hash, ''),\n        pageSource,\n        inlineScriptSourceRegExp,\n        inlineScriptSource,\n        scripts = document.getElementsByTagName('script'); // Live NodeList collection\n  \n      if (scriptLocation === currentLocation) {\n        pageSource = document.documentElement.outerHTML;\n        inlineScriptSourceRegExp = new RegExp('(?:[^\\\\n]+?\\\\n){0,' + (line - 2) + '}[^<]*<script>([\\\\d\\\\D]*?)<\\\\/script>[\\\\d\\\\D]*', 'i');\n        inlineScriptSource = pageSource.replace(inlineScriptSourceRegExp, '$1').trim();\n      }\n  \n      for (var i = 0; i < scripts.length; i++) {\n        // If ready state is interactive, return the script tag\n        if (scripts[i].readyState === 'interactive') {\n          return scripts[i];\n        }\n  \n        // If src matches, return the script tag\n        if (scripts[i].src === scriptLocation) {\n          return scripts[i];\n        }\n  \n        // If inline source matches, return the script tag\n        if (\n          scriptLocation === currentLocation &&\n          scripts[i].innerHTML &&\n          scripts[i].innerHTML.trim() === inlineScriptSource\n        ) {\n          return scripts[i];\n        }\n      }\n  \n      // If no match, return null\n      return null;\n    }\n  };\n\n  return getCurrentScript\n}));\n","// This file is imported into lib/wc client bundles.\n\nif (typeof window !== 'undefined') {\n  var currentScript = window.document.currentScript\n  if (process.env.NEED_CURRENTSCRIPT_POLYFILL) {\n    var getCurrentScript = require('@soda/get-current-script')\n    currentScript = getCurrentScript()\n\n    // for backward compatibility, because previously we directly included the polyfill\n    if (!('currentScript' in document)) {\n      Object.defineProperty(document, 'currentScript', { get: getCurrentScript })\n    }\n  }\n\n  var src = currentScript && currentScript.src.match(/(.+\\/)[^/]+\\.js(\\?.*)?$/)\n  if (src) {\n    __webpack_public_path__ = src[1] // eslint-disable-line\n  }\n}\n\n// Indicate to webpack that this file can be concatenated\nexport default null\n","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport class Media {\r\n    constructor() {\r\n        this._constraints = {\r\n            audio: true,\r\n            video: false\r\n        };\r\n        let that = this;\r\n        let oldUserMedia = function(constraints) {\r\n            let getUserMedia = (navigator.getUserMedia || navigator.webketGetUserMedia || navigator.mozGetUserMedia);\r\n\r\n            if (!getUserMedia) {\r\n                return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\r\n            }\r\n\r\n            return new Promise(function(res, rej) {\r\n                getUserMedia.call(navigator, constraints, res, rej);\r\n            });\r\n        };\r\n        if (navigator.mediaDevices === undefined) {\r\n            navigator.mediaDevices = {};\r\n        }\r\n        if (navigator.mediaDevices.getUserMedia === undefined) {\r\n            navigator.mediaDevices.getUserMedia = oldUserMedia;\r\n        }\r\n\r\n    }\r\n    promiseStream() {\r\n        let pm = new Promise((res, rej) => {\r\n            navigator.mediaDevices.getUserMedia(this._constraints)\r\n                .then(stream => {\r\n                    res(stream);\r\n                })\r\n                .catch(error => {\r\n                    rej(error);\r\n                });\r\n        });\r\n        return pm;\r\n    }\r\n}","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport class Context {\r\n    /**\r\n     * \r\n     * @param {object} config \r\n     */\r\n    constructor(config) {\r\n        this._context = null;\r\n        this._config = config;\r\n        try {\r\n            window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext || window.msAudioContext;\r\n            this._context = new AudioContext();\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n    }\r\n    isSupport() {\r\n        return !(this._context === null);\r\n    }\r\n}","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { Context } from \"./context\";\r\n\r\nexport class InContext extends Context {\r\n    /**\r\n     *\r\n     * @param {object} config\r\n     * @param {stream} mediaStream\r\n     */\r\n    constructor(config, mediaStream) {\r\n\r\n        super(config);\r\n\r\n        this._lsize = 0;\r\n        this._rsize = 0;\r\n        this._LBuffer = [];\r\n        this._RBuffer = [];\r\n        this._recording = false;\r\n        //这个特性在2014年8月29日发布的Web Audio API规范中已经标记为不推荐，将很快会被Audio Workers代替.\r\n        this._scriptProcessorNode = this._context.createScriptProcessor(this._config.bufferSize, this._config.numberChannels, this._config.numberChannels);\r\n        this._mediaStreamAudioSourceNode = this._context.createMediaStreamSource(mediaStream);\r\n\r\n        this._mediaStreamAudioSourceNode.connect(this._scriptProcessorNode);\r\n        this._scriptProcessorNode.connect(this._context.destination);\r\n\r\n        let that = this;\r\n        this._scriptProcessorNode.onaudioprocess = function(audioProcessEvent) {\r\n            if (!that._recording) return;\r\n            let inputBuffer = audioProcessEvent.inputBuffer;\r\n            //TODO 多个通道塞数据可能有问题\r\n            for (let channel = 0; channel < inputBuffer.numberOfChannels; channel++) {\r\n                let inputData = inputBuffer.getChannelData(channel);\r\n                if (channel === 0) {\r\n                    that._LBuffer.push(new Float32Array(inputData));\r\n                    that._lsize += inputData.length;\r\n                } else if (channel === 1) {\r\n                    that._RBuffer.push(new Float32Array(inputData));\r\n                    that._rsize += inputData.length;\r\n                }\r\n            }\r\n            config.player.send();\r\n        };\r\n    }\r\n    clear() {\r\n        this._LBuffer.length = 0;\r\n        this._RBuffer.length = 0;\r\n        this._lsize = 0;\r\n        this._lsize = 0;\r\n    }\r\n\r\n    start() {\r\n        this._recording = true;\r\n    }\r\n    get() {\r\n        let inputSampleRate = this._context.sampleRate; //输入采样率\r\n        let outSampleRate = this._config.outputSampleRate; //输出采样率\r\n        //合并数组中的数组为1个连续数组\r\n        let mergeBuffers = function(buffer, length) {\r\n            let result = new Float32Array(length);\r\n            let offset = 0;\r\n            for (let i = 0; i < buffer.length; i++) {\r\n                result.set(buffer[i], offset);\r\n                offset += buffer[i].length;\r\n            }\r\n            return result;\r\n        };\r\n        //合并左右2个通道的数组对象为一个数组  LRLRLR 方式\r\n        let interleave = function(inputL, inputR) {\r\n            let length = inputL.length + inputR.length;\r\n            let result = new Float32Array(length);\r\n\r\n            let index = 0,\r\n                inputIndex = 0;\r\n\r\n            while (index < length) {\r\n                result[index++] = inputL[inputIndex];\r\n                result[index++] = inputR[inputIndex];\r\n                inputIndex++;\r\n            }\r\n            return result;\r\n        };\r\n        //合并\r\n        let data = null;\r\n        if (this._config.numberChannels === 1) {\r\n            data = mergeBuffers(this._LBuffer, this._lsize);\r\n        } else if (this._config.numberChannels === 2) {\r\n            let dataL = mergeBuffers(this._LBuffer, this._lsize);\r\n            let dataR = mergeBuffers(this._RBuffer, this._rsize);\r\n            data = interleave(dataL, dataR);\r\n        }\r\n        //压缩\r\n        // let compression = parseInt(inputSampleRate / outSampleRate);\r\n        // let length = data.length / compression;\r\n        // let result = new Float32Array(length);\r\n        // let index = 0,\r\n        //     j = 0;\r\n        // while (index < length) {\r\n        //     result[index] = data[j];\r\n        //     j += compression;\r\n        //     index++;\r\n        // }\r\n        console.log('data格式'+data)\r\n        return data;\r\n    }\r\n    stop() {\r\n        this._recording = false;\r\n    }\r\n}\r\n","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { Context } from \"./context\";\r\n\r\n\r\nexport class OutAudioContext extends Context {\r\n    constructor(config) {\r\n        super(config);\r\n    }\r\n    start() {\r\n            let gainNode = this._context.createGain();\r\n            this._audioBufferSourceNode = this._context.createBufferSource();\r\n            this._audioBufferSourceNode.connect(gainNode);\r\n            gainNode.connect(this._context.destination);\r\n            this._audioBufferSourceNode.start();\r\n        }\r\n        /**\r\n         * 放入已经压缩过的音频文件数据(audio.wav/audio.mp3)\r\n         * @param {ArrayBuffer} audioData 音频数据\r\n         */\r\n    pushAudioData(audioData) {\r\n            this._context.decodeAudioData(audioData)\r\n                .then(audioBuffer => {\r\n                    this._audioBufferSourceNode.buffer = audioBuffer;\r\n                })\r\n                .catch(e => {\r\n                    throw e;\r\n                });\r\n        }\r\n        /**\r\n         * 放入已经压缩过的原始音频数据流\r\n         * @param {Array} arrayBuffer 数据\r\n         */\r\n    pushDataArray(arrayBuffer) {\r\n        let audioBuffer = this._context.createBuffer(this._config.numberChannels, this._context.sampleRate * 5, this._context.sampleRate);\r\n        for (let index = 0; index < this._config.numberChannels.length; index++) {\r\n            let tempBuffer = audioBuffer.getChannelData(index); //TODO\r\n            for (let index2 = 0; index2 < array.length; index2++) {\r\n                tempBuffer[index2] = array[index2];\r\n            }\r\n        }\r\n        this._audioBufferSourceNode.buffer = audioBuffer;\r\n    }\r\n}\r\n","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport const defaultConfig = {\r\n    url: '',\r\n    bufferSize: 2048,\r\n    numberChannels: 1,\r\n    inputSampleBits: 16, //输入采样位数 8,16\r\n    outputSampleRate: 16000 / 6, //输出采样率 7350\r\n    outputSampleBits: 16 //输出采样位数 8,16\r\n}\r\n","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport class Encoder {\r\n    constructor() {\r\n\r\n    }\r\n\r\n    static wav(bytes, sampleRate, sampleBits, outChannelsNumber) {\r\n        let dataLength = bytes.length * (sampleBits / 8);\r\n        let buffer = new ArrayBuffer(44 + dataLength);\r\n        let data = new DataView(buffer);\r\n\r\n        let channelCount = outChannelsNumber;\r\n        let offset = 0;\r\n\r\n        let writeString = function(str) {\r\n            for (let i = 0; i < str.length; i++) {\r\n                data.setUint8(offset + i, str.charCodeAt(i));\r\n            }\r\n        };\r\n        // https://baike.baidu.com/item/WAV\r\n        //资源交换文件标志（RIFF）\r\n        writeString('RIFF');\r\n        offset += 4;\r\n        //从下个地址开始到文件尾的总字节数\r\n        data.setUint32(offset, 36 + dataLength, true);\r\n        offset += 4;\r\n        //WAV文件标志（WAVE）\r\n        writeString('WAVE');\r\n        offset += 4;\r\n        //波形格式标志（fmt ），最后一位空格\r\n        writeString('fmt ');\r\n        offset += 4;\r\n        //过滤字节（一般为00000010H），若为00000012H则说明数据头携带附加信息（见“附加信息”）\r\n        data.setUint32(offset, 16, true);\r\n        offset += 4;\r\n        //格式种类（值为1时，表示数据为线性PCM编码）\r\n        data.setUint16(offset, 1, true);\r\n        offset += 2;\r\n        //通道数，单声道为1，双声道为2\r\n        data.setUint16(offset, channelCount, true);\r\n        offset += 2;\r\n        //采样频率\r\n        data.setUint32(offset, sampleRate, true);\r\n        offset += 4;\r\n        //波形数据传输速率（每秒平均字节数）\r\n        data.setUint32(offset, channelCount * sampleRate * (sampleBits / 8), true);\r\n        offset += 4;\r\n        //DATA数据块长度，字节  快数据调整数 采样一次占用字节数 通道数×每样本的数据位数/8\r\n        data.setUint16(offset, channelCount * (sampleBits / 8), true);\r\n        offset += 2;\r\n        //PCM位宽\r\n        data.setUint16(offset, sampleBits, true);\r\n        offset += 2;\r\n        //--------//\r\n        //附加信息（可选，由上方过滤字节确定）\r\n        //“fact”,该部分是可选部分，一般当WAV文件是由某些软件转换而来时，包含该部分。\r\n        //若包含该部分：（1）该部分的前4字节为数据头，一般为4个字母。\r\n        //（2）随后4个字节表示长度，即除去头（4字节）和长度（4字节）之后，数据本身的长度。\r\n        //（3）最后的字节为数据本身。例如：“66 61 73 74 04 00 00 00F8 2F 14 00” 。\r\n        //“66 61 73 74”是fact字段的数据头，“04 00 00 00”是数据本身的长度，“F8 2F 14 00”是数据本身。\r\n        //（注意是little-endian字节顺序）\r\n        //-------//\r\n        //数据标志符（data）\r\n        writeString('data');\r\n        offset += 4;\r\n        //DATA总数据长度字节\r\n        data.setUint32(offset, dataLength, true);\r\n        offset += 4;\r\n\r\n        if (sampleBits === 8) {\r\n            for (let i = 0; i < bytes.length; i++, offset++) {\r\n                let s = Math.max(-1, Math.min(1, bytes[i]));\r\n                let val = s < 0 ? s * 0x8000 : s * 0x7FFF;\r\n                val = parseInt(255 / (65535 / (val + 32768)));\r\n                data.setInt8(offset, val, true);\r\n            }\r\n        } else {\r\n            for (let i = 0; i < bytes.length; i++, offset += 2) {\r\n                let s = Math.max(-1, Math.min(1, bytes[i]));\r\n                data.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n}","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nexport class WS {\r\n    constructor(url) {\r\n        this._isConnected = false;\r\n        this._websocket = new WebSocket(url);\r\n        this._websocket.binaryType = \"arraybuffer\"; //blob,arraybuffer\r\n        this._receivedEvent = null;\r\n        this._errorEvent = null;\r\n        let that = this;\r\n        this._websocket.onopen = function(e) {\r\n            that._isConnected = true;\r\n        };\r\n        this._websocket.onmessage = function(e) {\r\n            if (that._receivedEvent) {\r\n                that._receivedEvent(e.data);\r\n            }\r\n        };\r\n        this._websocket.onerror = function(e) {\r\n            if (that._errorEvent) {\r\n                that._errorEvent(e);\r\n            }\r\n        }\r\n    }\r\n\r\n    send(blobData) {\r\n        if (this._isConnected) {\r\n            this._websocket.send(blobData);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    close() {\r\n        if (this._websocket.bufferedAmount === 0) {\r\n            this._websocket.close();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    on(eventName, fn) {\r\n        switch (eventName) {\r\n            case 'received':\r\n                typeof fn === 'function' ? this._receivedEvent = fn : this._receivedEvent = null;\r\n            case 'error':\r\n                typeof fn === 'function' ? this._errorEvent = fn : this._errorEvent = null;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n}","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport class BlobData {\r\n    constructor() {\r\n\r\n    }\r\n    static wav(data) {\r\n        return new Blob([data], {\r\n            type: 'audio/wav'\r\n        })\r\n    }\r\n}","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport class As3Context {\r\n    constructor(config) {\r\n        this.as3ele = null;\r\n        let flashvars = {\r\n            outSampleRate: config.outputSampleRate,\r\n            numberChannels: config.numberChannels\r\n        };\r\n        let params = {\r\n            menu: 'false',\r\n            scale: 'noScale',\r\n            allowFullscreen: 'true',\r\n            allowScriptAccess: 'always',\r\n            bgcolor: '',\r\n            wmode: 'direct'\r\n        };\r\n        let attributes = {\r\n            id: 'audioas3'\r\n        };\r\n        let swfpath = config.swfPath ? config.swfPath : './audio.swf';\r\n        let domid = config.domid;\r\n\r\n        if (!domid) {\r\n            throw new Error('audio.swf need a dom element');\r\n            return;\r\n        }\r\n        if (swfobject) {\r\n            let ele = document.getElementById(domid);\r\n            let that = this;\r\n            swfobject.embedSWF(\r\n                swfpath, domid, ele.clientWidth, ele.clientHeight, '25.0.0', './expressInstall.swf', flashvars, params, attributes,\r\n                function() {\r\n                    that.as3ele = document.getElementById(attributes.id);\r\n                }\r\n            );\r\n\r\n        } else {\r\n            throw new Error('the swfobject is need');\r\n            return;\r\n        }\r\n\r\n    }\r\n\r\n    ready() {\r\n        this.as3ele.ready();\r\n    }\r\n\r\n    start() {\r\n        this.as3ele.start();\r\n    }\r\n\r\n    stop() {\r\n        this.as3ele.stop();\r\n    }\r\n\r\n    clear() {\r\n        this.as3ele.clear();\r\n    }\r\n\r\n    get() {\r\n        return this.as3ele.getbuffer();\r\n    }\r\n}","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport class Audio {\r\n    constructor() {\r\n        //let audio = document.createElement('audio');\r\n        //audio.setAttribute('autoplay', true);\r\n        //IE 下的wav要bgsound播放\r\n        let audio = document.createElement('bgsound');\r\n        audio.setAttribute('loop', 'false');\r\n        audio.setAttribute('audostart', 'true');\r\n        audio.setAttribute('style', 'display:none;');\r\n        audio.id = 'audioas3_' + new Date().getTime();\r\n        let body = document.querySelector('body');\r\n        body.appendChild(audio);\r\n        this._audio = document.getElementById(audio.id);\r\n    }\r\n    play(blob) {\r\n        this._audio.src = window.URL.createObjectURL(blob);\r\n    }\r\n}","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport class PollFill {\r\n    constructor() {\r\n\r\n    }\r\n\r\n    static deepAssign(target) {\r\n        var hasOwnProperty = Object.prototype.hasOwnProperty;\r\n        var propIsEnumerable = Object.prototype.propertyIsEnumerable;\r\n        var isObj = function(x) {\r\n            var type = typeof x;\r\n            return x !== null && (type === 'object' || type === 'function');\r\n        }\r\n        var toObject = function(val) {\r\n            if (val === null || val === undefined) {\r\n                throw new TypeError('Cannot convert undefined or null to object');\r\n            }\r\n            return Object(val);\r\n        }\r\n        var assignKey = function(to, from, key) {\r\n            var val = from[key];\r\n            if (val === undefined || val === null) {\r\n                return;\r\n            }\r\n            if (hasOwnProperty.call(to, key)) {\r\n                if (to[key] === undefined || to[key] === null) {\r\n                    throw new TypeError('Cannot convert undefined or null to object (' + key + ')');\r\n                }\r\n            }\r\n            if (!hasOwnProperty.call(to, key) || !isObj(val)) {\r\n                to[key] = val;\r\n            } else {\r\n                to[key] = assign(Object(to[key]), from[key]);\r\n            }\r\n        }\r\n\r\n        var assign = function(to, from) {\r\n            if (to === from) {\r\n                return to;\r\n            }\r\n\r\n            from = Object(from);\r\n\r\n            for (var key in from) {\r\n                if (hasOwnProperty.call(from, key)) {\r\n                    assignKey(to, from, key);\r\n                }\r\n            }\r\n\r\n            if (Object.getOwnPropertySymbols) {\r\n                var symbols = Object.getOwnPropertySymbols(from);\r\n\r\n                for (var i = 0; i < symbols.length; i++) {\r\n                    if (propIsEnumerable.call(from, symbols[i])) {\r\n                        assignKey(to, from, symbols[i]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return to;\r\n        }\r\n\r\n        target = toObject(target);\r\n\r\n        for (var s = 1; s < arguments.length; s++) {\r\n            assign(target, arguments[s]);\r\n        }\r\n\r\n        return target;\r\n    }\r\n}","function PCMPlayer(option) {\r\n    this.init(option);\r\n}\r\n\r\nPCMPlayer.prototype.init = function(option) {\r\n    var defaults = {\r\n        encoding: '16bitInt',\r\n        channels: 1,\r\n        sampleRate: 8000,\r\n        flushingTime: 1000\r\n    };\r\n    this.option = Object.assign({}, defaults, option);\r\n    this.samples = new Float32Array();\r\n    this.flush = this.flush.bind(this);\r\n    this.interval = setInterval(this.flush, this.option.flushingTime);\r\n    this.maxValue = this.getMaxValue();\r\n    this.typedArray = this.getTypedArray();\r\n    this.createContext();\r\n};\r\n\r\nPCMPlayer.prototype.getMaxValue = function () {\r\n    var encodings = {\r\n        '8bitInt': 128,\r\n        '16bitInt': 32768,\r\n        '32bitInt': 2147483648,\r\n        '32bitFloat': 1\r\n    }\r\n\r\n    return encodings[this.option.encoding] ? encodings[this.option.encoding] : encodings['16bitInt'];\r\n};\r\n\r\nPCMPlayer.prototype.getTypedArray = function () {\r\n    var typedArrays = {\r\n        '8bitInt': Int8Array,\r\n        '16bitInt': Int16Array,\r\n        '32bitInt': Int32Array,\r\n        '32bitFloat': Float32Array\r\n    }\r\n\r\n    return typedArrays[this.option.encoding] ? typedArrays[this.option.encoding] : typedArrays['16bitInt'];\r\n};\r\n\r\nPCMPlayer.prototype.createContext = function() {\r\n    this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();\r\n    this.gainNode = this.audioCtx.createGain();\r\n    this.gainNode.gain.value = 1;\r\n    this.gainNode.connect(this.audioCtx.destination);\r\n    this.startTime = this.audioCtx.currentTime;\r\n};\r\n\r\nPCMPlayer.prototype.isTypedArray = function(data) {\r\n    return (data.byteLength && data.buffer && data.buffer.constructor == ArrayBuffer);\r\n};\r\n\r\nPCMPlayer.prototype.feed = function(data) {\r\n    if (!this.isTypedArray(data)) return;\r\n    data = this.getFormatedValue(data);\r\n    var tmp = new Float32Array(this.samples.length + data.length);\r\n    tmp.set(this.samples, 0);\r\n    tmp.set(data, this.samples.length);\r\n    this.samples = tmp;\r\n};\r\n\r\nPCMPlayer.prototype.getFormatedValue = function(data) {\r\n    var data = new this.typedArray(data.buffer),\r\n        float32 = new Float32Array(data.length),\r\n        i;\r\n\r\n    for (i = 0; i < data.length; i++) {\r\n        float32[i] = data[i] / this.maxValue;\r\n    }\r\n    return float32;\r\n};\r\n\r\nPCMPlayer.prototype.volume = function(volume) {\r\n    this.gainNode.gain.value = volume;\r\n};\r\n\r\nPCMPlayer.prototype.destroy = function() {\r\n    if (this.interval) {\r\n        clearInterval(this.interval);\r\n    }\r\n    this.samples = null;\r\n    this.audioCtx.close();\r\n    this.audioCtx = null;\r\n};\r\n\r\nPCMPlayer.prototype.flush = function() {\r\n    if (!this.samples.length) return;\r\n    var bufferSource = this.audioCtx.createBufferSource(),\r\n        length = this.samples.length / this.option.channels,\r\n        audioBuffer = this.audioCtx.createBuffer(this.option.channels, length, this.option.sampleRate),\r\n        audioData,\r\n        channel,\r\n        offset,\r\n        i,\r\n        decrement;\r\n\r\n    for (channel = 0; channel < this.option.channels; channel++) {\r\n        audioData = audioBuffer.getChannelData(channel);\r\n        offset = channel;\r\n        decrement = 50;\r\n        for (i = 0; i < length; i++) {\r\n            audioData[i] = this.samples[offset];\r\n            /* fadein */\r\n            if (i < 50) {\r\n                audioData[i] =  (audioData[i] * i) / 50;\r\n            }\r\n            /* fadeout*/\r\n            if (i >= (length - 51)) {\r\n                audioData[i] =  (audioData[i] * decrement--) / 50;\r\n            }\r\n            offset += this.option.channels;\r\n        }\r\n    }\r\n    \r\n    if (this.startTime < this.audioCtx.currentTime) {\r\n        this.startTime = this.audioCtx.currentTime;\r\n    }\r\n    console.log('start vs current '+this.startTime+' vs '+this.audioCtx.currentTime+' duration: '+audioBuffer.duration);\r\n    bufferSource.buffer = audioBuffer;\r\n    bufferSource.connect(this.gainNode);\r\n    bufferSource.start(this.startTime);\r\n    this.startTime += audioBuffer.duration;\r\n    this.samples = new Float32Array();\r\n};\r\n\r\nexport default PCMPlayer;","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { Media } from \"./media\";\r\nimport { InContext } from \"./incontext\";\r\nimport { OutAudioContext } from \"./outcontext\";\r\nimport { defaultConfig } from \"../config\";\r\nimport { Encoder } from \"../io/encoder\";\r\nimport { WS } from \"../net/ws\";\r\nimport { BlobData } from \"../io/blob\";\r\nimport { As3Context } from \"./as3context\";\r\nimport { Audio } from \"./audio\";\r\nimport { PollFill } from \"../utils/pollfill\";\r\nimport PCMPlayer from \"./pcm-player\";\r\n\r\nexport class Player {\r\n    constructor(config) {\r\n        this._config = {\r\n          player:this\r\n        };\r\n        PollFill.deepAssign(this._config, defaultConfig, config ? config : defaultConfig);\r\n        let that = this;\r\n        let outcontext = new OutAudioContext(that._config);\r\n        let audio = new Audio();\r\n        this._incontext = null;\r\n        this._as3context = null;\r\n\r\n        if (!outcontext.isSupport()) {\r\n            this._as3context = new As3Context(that._config);\r\n        }\r\n        this._ws = new WS(this._config.url);\r\n\t\tvar player = new PCMPlayer({\r\n\t\t    encoding: '16bitInt',\r\n\t\t    channels: 1,\r\n\t\t    sampleRate: 16000,\r\n\t\t    flushingTime: 2000\r\n        });\r\n        this._ws.on('received', function(dataBuffer) {\r\n\r\n          var data = new Uint8Array(dataBuffer);\r\n          player.feed(data);\r\n            // if (outcontext.isSupport()) {\r\n            //     outcontext.start();\r\n            //     outcontext.pushAudioData(dataBuffer);\r\n            // } else {\r\n            //     let wavblob = BlobData.wav(dataBuffer);\r\n            //     audio.play(wavblob);\r\n            // }\r\n        });\r\n    }\r\n    ready() {\r\n        let that = this;\r\n        let media = new Media();\r\n        if (window.Promise) {\r\n            media.promiseStream()\r\n                .then(medisStream => {\r\n                    that._incontext = new InContext(that._config, medisStream);\r\n                }).catch(e => {\r\n                    that._as3context.ready();\r\n                });\r\n        } else {\r\n            that._as3context.ready();\r\n        }\r\n    }\r\n\r\n    speak() {\r\n        if (this._incontext) {\r\n            this._incontext.start();\r\n        } else if (this._as3context) {\r\n            this._as3context.start();\r\n        }\r\n    }\r\n    send() {\r\n        if (this._incontext) {\r\n           let dataBuffer = this._incontext.get();\r\n           let wavDataBuffer = Encoder.wav(dataBuffer, this._config.outputSampleRate, this._config.outputSampleBits, this._config.numberChannels);\r\n           let buffer = wavDataBuffer.buffer\r\n           this._ws.send(buffer.slice(44,buffer.length))\r\n           // this._ws.send(wavDataBuffer);\r\n           //this._incontext.stop();\r\n           this._incontext.clear();\r\n        } else if (this._as3context) {\r\n            let dataBuffer = this._as3context.get();\r\n            //let wavDataBuffer = Encoder.wav(dataBuffer, this._config.outputSampleRate, this._config.outputSampleBits, this._config.numberChannels);\r\n            this._ws.send(dataBuffer);\r\n            this._as3context.stop();\r\n            this._as3context.clear();\r\n        }\r\n    }\r\n    close() {\r\n      if (this._incontext) {\r\n         this._incontext.stop();\r\n         console.log('已关闭通话')\r\n      }else if(this._as3context){\r\n         this._as3context.stop();\r\n      }\r\n    }\r\n    getbuffer(cb) {\r\n        if (this._incontext && typeof cb === \"function\") {\r\n            let dataBuffer = this._incontext.get();\r\n            this._incontext.stop();\r\n            this._incontext.clear();\r\n            cb(dataBuffer);\r\n        } else if (this._as3context) {\r\n            let dataBuffer = this._as3context.get();\r\n            this._as3context.stop();\r\n            this._as3context.clear();\r\n            cb(dataBuffer);\r\n        }\r\n    }\r\n    exportwav(cb) {\r\n        if (this._incontext && typeof cb === \"function\") {\r\n            let dataBuffer = this._incontext.get();\r\n            let wavDataBuffer = Encoder.wav(dataBuffer, this._config.outputSampleRate, this._config.outputSampleBits, this._config.numberChannels);\r\n            let wavblob = BlobData.wav(wavDataBuffer);\r\n            this._incontext.stop();\r\n            this._incontext.clear();\r\n            cb(wavblob);\r\n        } else if (this._as3context) {\r\n            let dataBuffer = this._as3context.get();\r\n            let wavDataBuffer = Encoder.wav(dataBuffer, this._config.outputSampleRate, this._config.outputSampleBits, this._config.numberChannels);\r\n            let wavblob = BlobData.wav(wavDataBuffer.buffer);\r\n            this._as3context.stop();\r\n            this._as3context.clear();\r\n            cb(wavblob);\r\n        }\r\n    }\r\n    forcedownload(filename) {\r\n        this.exportwav(function(blob) {\r\n            let url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n            let link = window.document.createElement('a');\r\n            link.href = url;\r\n            link.download = filename || new Date().toISOString() + '.wav';\r\n            let click = document.createEvent(\"Event\");\r\n            click.initEvent(\"click\", true, true);\r\n            link.dispatchEvent(click);\r\n        });\r\n    }\r\n}\r\n","/*\r\n * Copyright (C) 2017 wangdehai. All Rights Reserved.\r\n *\r\n * @author level <dehai168@gmail.com>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { Media } from './core/media';\r\nimport { Player } from \"./core/player\";\r\n\r\nlet webvoice = {};\r\nlet media = new Media();\r\n\r\nwebvoice.createPlayer = function(config) {\r\n    return new Player(config);\r\n};\r\n\r\nObject.defineProperty(webvoice, 'version', {\r\n    enumerable: true,\r\n    get: function() {\r\n        return '0.0.2';\r\n    }\r\n});\r\n\r\nexport { webvoice };","import './setPublicPath'\nexport * from '~entry'\n"],"sourceRoot":""}